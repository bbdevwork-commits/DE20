transformations:
  - name: "standardize_dates"
    type: "date_format"
    source_column: "transaction_date"
    target_column: "transaction_date_formatted"
    format: "yyyy-MM-dd HH:mm:ss"

  - name: "calculate_tax"
    type: "derived_column"
    expression: "amount * 0.08"
    target_column: "tax_amount"

  - name: "total_with_tax"
    type: "derived_column"
    expression: "amount + tax_amount"
    target_column: "total_amount"

  - name: "uppercase_product"
    type: "string_transform"
    source_column: "product_code"
    target_column: "product_code"
    operation: "uppercase"

  - name: "extract_year"
    type: "date_extract"
    source_column: "transaction_date"
    target_column: "transaction_year"
    extract: "year"

  - name: "extract_month"
    type: "date_extract"
    source_column: "transaction_date"
    target_column: "transaction_month"
    extract: "month"

aggregations:
  - name: "daily_totals"
    group_by:
      - "transaction_date_formatted"
    metrics:
      - column: "total_amount"
        function: "sum"
        alias: "daily_total"
      - column: "transaction_id"
        function: "count"
        alias: "transaction_count"

settings:
  preserve_original: true
  drop_nulls: false
